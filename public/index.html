<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>C Compiler Explorer</title>
  <script src="loader.js" defer></script>
</head>
<body>
  <h1>C Compiler Explorer</h1>
  <textarea id="code" rows="10" cols="80">#include &lt;stdio.h&gt;\nint main() { return 0; }</textarea>
  <br>
  <select id="compiler">
    <option value="gcc">GCC</option>
    <option value="clang">Clang</option>
  </select>
  <select id="mode">
    <option value="preprocess">Preprocess</option>
    <option value="ir">LLVM IR (Clang only)</option>
    <option value="asm">Assembly</option>
    <option value="bin">Executable</option>
  </select>

  <button onclick="compile()">Compile</button>
  <pre id="output"></pre>

  <script>
    async function compile() {
      const code = document.getElementById("code").value;
      const compiler = document.getElementById("compiler").value;
      const mode = document.getElementById("mode").value;

      const res = await fetch("/compile", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ code, compiler, mode })
      });

      const data = await res.json();
      document.getElementById("output").textContent =
        data.error ? `Error:\n${data.output}\n${data.error}` : data.output;
    }
  </script>
</body>
</html>
